# グローバルルール（全プロジェクト共通）

このファイルは全てのプロジェクトに適用される共通ルールです。

---

## セッション開始時のワークフロー

### 新規プロジェクト・不明な作業の場合

**まず以下を確認してから進める：**

1. **何を実現したいか？**
   - Webアプリ / API / CLI / モバイル / その他

2. **技術的な制約や希望は？**
   - 使いたい言語・フレームワーク
   - 既存システムとの連携
   - デプロイ先

3. **優先度は？**
   - スピード重視（プロトタイプ）
   - 品質重視（本番運用）
   - 学習目的

4. **チーム構成は？**
   - 個人 / チーム / オープンソース

**確認後、最適な技術スタックとフォルダ構成を提案してから実行する。**

---

## 技術スタック選定ガイド

### ローカル開発（シンプル・高速）

```
フロントエンド: Next.js (App Router) + TypeScript
データベース:   SQLite
スタイリング:   Tailwind CSS + shadcn/ui + Radix
アイコン:       Lucide Icons
アニメーション: Framer Motion
```

### 本番向け追加構成

```
認証:   Clerk
DB:     Supabase
決済:   Stripe
ホスト: Vercel / AWS
```

### 選定の判断基準

| 優先度 | フロント | バックエンド | DB |
|-------|---------|------------|-----|
| スピード | Next.js | API Routes | SQLite |
| スケール | Next.js | 別サーバー | Supabase/PostgreSQL |
| 学習 | React単体 | Express | SQLite |

---

## プロジェクト構成ベストプラクティス

### 推奨フォルダ構成

```
project-root/
├── .claude/                        # Claude Code設定
│   ├── settings.json              # [Git管理] チーム権限設定
│   ├── settings.local.json        # [Git除外] 個人設定
│   ├── commands/                  # [Git管理] カスタムコマンド
│   ├── skills/                    # [Git管理] プロジェクトスキル
│   └── agents/                    # [Git管理] サブエージェント
├── scripts/                        # 自動化スクリプト
│   ├── hooks/                     # Hooks用（pre-commit等）
│   └── ci/                        # CI/CD用
├── src/                           # ソースコード
├── CLAUDE.md                      # [Git管理] プロジェクトルール
├── CLAUDE.local.md                # [Git除外] 個人ルール
├── .mcp.json                      # [Git管理] MCP外部連携
└── .gitignore
```

### 必須 .gitignore

```gitignore
# Claude Code個人設定
.claude/settings.local.json
CLAUDE.local.md

# 機密情報
.env
.env.*
*.pem
*.key
credentials.json

# ビルド成果物
node_modules/
.next/
dist/
```

### settings.json テンプレート

```json
{
  "permissions": {
    "allow": [
      "Read", "Write", "Edit", "Glob", "Grep",
      "Bash(npm:*)", "Bash(pnpm:*)",
      "Bash(git status:*)", "Bash(git diff:*)", "Bash(git log:*)"
    ],
    "ask": [
      "Bash(git push:*)", "Bash(git commit:*)",
      "Bash(docker:*)"
    ],
    "deny": [
      "Read(**/.env)", "Read(**/.env.*)",
      "Read(**/*.pem)", "Read(**/*.key)",
      "Bash(sudo:*)", "Bash(rm -rf:*)",
      "Bash(curl:*)", "Bash(wget:*)"
    ]
  }
}
```

### CLAUDE.md に含めるべき内容

1. プロジェクト概要（1-2文）
2. 技術スタック
3. 開発コマンド（dev/build/test）
4. フォルダ構造（簡潔に）
5. プロジェクト固有のルール

**100〜200行以内に収める。詳細はdocs/に分離。**

---

## Scripts の活用

### Hooks用スクリプト（scripts/hooks/）

```bash
# scripts/hooks/pre-commit.sh
#!/bin/bash
npm run lint || exit 2
npm run test || exit 2
exit 0
```

**settings.json での設定:**
```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "Bash(git commit:*)",
      "command": "./scripts/hooks/pre-commit.sh"
    }]
  }
}
```

### CI/CD用スクリプト（scripts/ci/）

```bash
# scripts/ci/review.sh
#!/bin/bash
gh pr diff "$1" | claude -p "このPRをレビュー" \
  --allowedTools Read,Grep,Glob \
  --output-format json
```

---

## コーディング規約

### 命名規則
- 変数・関数: `camelCase`
- クラス: `PascalCase`
- 定数: `UPPER_SNAKE_CASE`
- ファイル: `kebab-case`

### コード品質
- DRY原則を守る
- 1関数1責任
- マジックナンバーは定数化
- コメントは日本語

---

## Git操作

### コミットメッセージ
```
[種別] 変更内容

種別: feat / fix / docs / refactor / test / chore
```

### ブランチ運用
- `main`: 本番
- `develop`: 開発
- `feature/*`: 機能開発
- `fix/*`: バグ修正

---

## セキュリティ

- 機密情報はコードに書かない
- .envはGit管理しない
- 外部API接続は確認を取る
- denyルールで機密ファイル読み取りを防ぐ

---

## 基本方針

- 日本語でコミュニケーション
- 簡潔で分かりやすい説明
- 不明点は確認してから作業
- 既存ファイルの編集を優先（新規作成は最小限）
- 大量の変更は事前に確認

---

## 作業フロー

1. **理解**: タスクの内容を把握
2. **確認**: 不明点があれば質問
3. **計画**: 複雑な場合は計画を立てる
4. **提案**: 技術選定・構成を提案
5. **承認**: ユーザーの承認を得る
6. **実装**: コードを書く
7. **検証**: 動作確認
8. **報告**: 完了を報告

---

## 参照ドキュメント

詳細なベストプラクティスは以下を参照：
- `/mnt/c/Users/西田貴彦/Documents/Cursor/P_Unico/101_ナレッジ/Claude_Code_プロジェクト構成完全ガイド.md`

---

*最終更新: 2026-01-13*
