# YouTube APIで「指定チャンネルの再生数」を取得してスプレッドシートに一覧出力（GAS）

この手順は **PC初心者向け**に、できるだけ迷わないように書いています。  
目的は次の2つです（どちらも同じスプレッドシート内で完結します）。

- **チャンネルの総再生数（all time）**を取得（任意）
- **動画URL一覧をスプレッドシートに貼るだけ**で、各動画の再生数を一覧出力

> 重要: YouTubeのデータ取得は **YouTube Data API v3** を使います。  
> APIを使うには **Google CloudでAPIキー** が必要です。

---

## 1. 完成イメージ（スプレッドシートの形）

シートが3つできます。

- `Input`  
  - **A列**: 動画URLを貼る（A2以降）※手入力でもOK  
  - **B1**: チャンネルURL / チャンネルID / `@handle`（任意）  
  - **C2**: チャンネル動画URLを自動取得する最大件数（任意）  
  - **C3**: 自動取得の前にA列を消すか（TRUE/FALSE、任意）
- `Output`  
  - 動画ごとの **再生数 / タイトル / 公開日** などが一覧で出ます
- `Summary`  
  - チャンネルの **総再生数** など（入力した場合）
  - 貼った動画URLの **合計再生数**

---

## 2. 事前に必要なもの

- Googleアカウント（Gmail等）
- Googleスプレッドシート（空でOK）
- YouTube Data API v3 の APIキー（この手順で作ります）

---

## 3. APIキーを取得する（Google Cloud）

### 3-1. Google Cloud Consoleを開く

- ブラウザで Google Cloud Console を開きます  
  - 検索で「Google Cloud Console」と入力して開いてOKです

### 3-2. プロジェクトを作成

1. 画面上部の「プロジェクト」付近をクリック
2. 「新しいプロジェクト」をクリック
3. プロジェクト名（例: `youtube-view-sheet`）を入力
4. 「作成」

### 3-3. YouTube Data API v3 を有効化

1. 左上メニュー（≡） → 「APIとサービス」 → 「ライブラリ」
2. 検索欄に `YouTube Data API v3` と入力
3. 「YouTube Data API v3」を開く
4. 「有効にする」

### 3-4. APIキーを作成

1. 左メニュー「APIとサービス」→「認証情報」
2. 「＋認証情報を作成」→「APIキー」
3. APIキーが表示されます（例: `AIza...`）
4. **このキーをコピーしてメモ**（後でGASに保存します）

### 3-5. （推奨）APIキーの制限（安全のため）

「APIキー」をクリックして詳細を開き、次を設定します。

- **APIの制限**: 「キーを制限」→ `YouTube Data API v3` を選択

※「アプリケーションの制限（HTTP参照元など）」は、GASの場合うまく縛れないことがあるので、まずは **APIの制限だけ**でOKです。

---

## 4. スプレッドシート側の準備（GASを貼り付ける）

### 4-1. スプレッドシートを作成

1. Googleドライブで「新規」→「Googleスプレッドシート」
2. 名前は何でもOK（例: `YouTube再生数`）

### 4-2. Apps Script（GAS）を開く

1. スプレッドシート上部メニューから「拡張機能」→「Apps Script」
2. 新しいタブ（または画面）でスクリプト編集画面が開きます

### 4-3. コードを貼り付け

1. 左側の「ファイル」で `Code.gs` を開く
2. 中身を全部消す
3. このリポジトリの `YouTube再生数取得_GAS.gs` の中身を **全部コピーして貼り付け**
4. 保存（フロッピーアイコン or `Ctrl+S`）

---

## 5. APIキーをGASに設定（スクリプトプロパティ）

このGASは、APIキーを **コード内に直書きせず**、スクリプトプロパティに保存します。

1. Apps Script 画面の左メニュー「プロジェクトの設定（歯車）」を開く
2. 「スクリプト プロパティ」までスクロール
3. 「スクリプト プロパティを追加」
4. 次のように入力して保存

- プロパティ: `YOUTUBE_API_KEY`
- 値: （さっきコピーしたAPIキー）

---

## 6. 初回の実行（権限の許可が必要）

### 6-1. スプレッドシートに戻って初期シートを作成

1. スプレッドシートをリロード（更新）
2. メニューに **「YouTube」** が追加されます
3. 「YouTube」→「初期シート作成/整形」をクリック

初回は「承認が必要です」などが出ます。  
表示に従って許可してください。

#### 権限画面での操作

1. 「確認」→ 自分のGoogleアカウントを選択
2. 「このアプリはGoogleで確認されていません」など出た場合
   - 「詳細」→「（安全ではないページ）に移動」→「許可」

※これは「あなたが自分で作ったスクリプト」だから出る表示です（よくあります）。

---

## 7. 動画URLを貼って、再生数を取得する

### 7-0. （おすすめ）チャンネル内の動画URLを「自動取得」してA列に入れる

「毎回URLをコピペするのが大変」な場合は、自動取得が便利です。

1. `Input` シートの **B1** にチャンネルを入力  
   - 例: `https://www.youtube.com/channel/UC...`  
   - 例: `https://www.youtube.com/@handle` または `@handle`  
   - 例: `https://www.youtube.com/user/Username`（一部の古い形式）
2. （任意）`Input` シートの **C2** に「最大取得件数」を入力  
   - 未入力なら **200件**（デフォルト）  
   - 多すぎると実行時間制限で失敗しやすいので、まずは200〜500推奨
3. （任意）`Input` シートの **C3** を `TRUE` にすると、既存のA列を消してから入れ直します
4. 上部メニュー「YouTube」→ **「チャンネル動画URLを取得（Inputへ）」** を実行
5. `Input` の **A2以降**に動画URLが自動で入ります

※取得されるのは「そのチャンネルのアップロード動画（uploads）」です。  
※ `https://www.youtube.com/c/〇〇` のようなカスタムURLは、見つからない場合があります（その時は `/channel/UC...` か `@handle` を使うのが確実です）。

### 7-1. URLを貼る場所

- `Input` シートの **A2以降**に、動画URLを貼ります（縦に並べる）

例:
- `https://www.youtube.com/watch?v=xxxxxxxxxxx`
- `https://youtu.be/xxxxxxxxxxx`
- `https://www.youtube.com/shorts/xxxxxxxxxxx`

### 7-2. （任意）チャンネルの総再生数も取りたい

`Input` シートの **B1** に以下のどれかを入力します。

- チャンネルURL（例: `https://www.youtube.com/channel/UC....`）
- もしくは `@handle`（例: `@example` や `https://www.youtube.com/@example`）
- もしくはチャンネルID（例: `UC....`）

### 7-3. 実行

1. スプレッドシート上部「YouTube」→「再生数取得（一覧出力）」
2. しばらく待つ（動画数が多いほど時間がかかります）
3. `Output` シートに一覧が出ます
4. `Summary` シートに合計やチャンネル統計が出ます（B1入力した場合）

---

## 8. よくあるエラーと対処

### 8-1. 「APIキーが未設定です」

スクリプトプロパティ `YOUTUBE_API_KEY` が未設定です。  
「5. APIキーをGASに設定」をやり直してください。

### 8-2. 「YouTube API エラー: HTTP 403」

よくある原因:

- Google Cloudで **YouTube Data API v3 を有効化していない**
- APIキーの **API制限** が間違っている
- クォータ（利用上限）に達した

対処:

- ライブラリで YouTube Data API v3 が「有効」になっているか確認
- 認証情報のAPIキーで、API制限に `YouTube Data API v3` が入っているか確認
- 時間を置いて再実行（クォータの場合）

### 8-3. URLから動画IDを抽出できない

URLが通常形式ではない場合があります。  
まずは `watch?v=` または `youtu.be/` のURLで試してください。

---

## 9. 補足（このGASが取っている値）

### 動画ごとの値（Output）

- タイトル
- 公開日
- 再生数
- 高評価
- コメント
- チャンネル名 / チャンネルID

### チャンネルの値（Summary、任意）

- チャンネル総再生数（all time）
- 登録者数（非公開の場合は空欄）
- 動画数

---

## 10. 次にできる改善（必要なら言ってください）

- （実装済み）チャンネル内の動画一覧を **自動で取得**（URL貼り付け不要にする）
- 「期間（例: 過去30日）」などの集計（※APIだけでは制限があり工夫が必要）
- 10万本など大量動画でも壊れにくいように分割実行・進捗表示

