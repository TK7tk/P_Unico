# CLAUDE.md

  このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイ ダンスを提供します。

  ## プロジェクト概要

  Next.js 14、TypeScript、Tailwind CSSで構築されたモダンなぷよぷよゲームアプリケーション。クラシックなパズルゲームに、モダンで先進的なUI/UX体験を提供することを目指 しています。

  ## 開発コマンド

  ```bash
  # 開発サーバーを起動 (http://localhost:3000)
  npm run dev

  # 本番用ビルド
  npm run build

  # 本番サーバーを起動
  npm start

  # Linterを実行
  npm run lint

  技術スタック

  - フレームワーク: Next.js 14 (App Router)
  - 言語: TypeScript (strict mode有効)
  - スタイリング: Tailwind CSS
  - フォント: Geist Sans および Geist Mono (ローカル最適化)

  アーキテクチャ

  App Router構造

  - Next.js App Router (app/ ディレクトリ) を使用
  - app/layout.tsx: フォント最適化とメタデータを含むルートレイアウト
  - app/page.tsx: メインエントリーポイント
  - パスエイリアス: @/* はプロジェクトルートにマッピング

  TypeScript設定

  - Strict mode有効
  - モジュール解決: bundler
  - @/* でインポートエイリアスを設定

  要件定義

  ゲーム基本仕様

  コアルール:
  - 同じ色のぷよが縦または横に4個以上つながると消える
  - ぷよが消えた後、残ったぷよは重力で落下する
  - 落下したぷよが新たなマッチを作ると連鎖が発生
  - ぷよがボードの上部まで積み上がるとゲームオーバー

  ボード設定:
  - ボードサイズ: 6列 × 12行 (標準)
  - 上部にスポーンゾーンがある可視プレイエリア
  - NEXTぷよのプレビュー (最低1-2個先まで)

  ぷよの種類:
  - 4-5色のバリエーション (赤、青、緑、黄、紫)
  - 特殊ぷよ (オプション): おじゃまぷよ、スターぷよ

  機能要件

  コアゲーム機能:
  1. 操作制御
    - 左右移動 (矢印キーまたはA/D)
    - 回転 (上矢印、スペース、またはW)
    - ソフトドロップ (下矢印またはS)
    - ハードドロップ (オプション、即座に設置)
    - ホールド/一時停止機能
  2. ゲームメカニクス
    - リアルタイム重力シミュレーション
    - 連鎖検出とスコアリングシステム
    - コンボ倍率計算
    - 段階的難易度上昇 (落下速度の増加)
  3. ゲームモード
    - シングルプレイヤー (エンドレスモード)
    - タイムアタック (制限時間内に目標をクリア)
    - VS CPU (オプション)
    - 練習モード (学習用の低速)
  4. UI機能
    - リアルタイム更新のスコア表示
    - 連鎖カウンターとコンボインジケーター
    - NEXTぷよプレビューパネル
    - ハイスコア記録 (localStorage)
    - 操作説明オーバーレイ/チュートリアル
    - 一時停止/再開機能
    - リスタートオプション付きゲームオーバー画面

  UI/UX要件

  モダンデザイン原則:
  - ゲームプレイに集中できるクリーンでミニマルなインターフェース
  - スムーズなアニメーション (60fps目標)
  - ぷよが消える際のパーティクルエフェクト
  - 連鎖とコンボの視覚的フィードバック
  - 色覚異常対応のカラーパレットオプション
  - レスポンシブデザイン (デスクトップとタブレット対応)

  アニメーション要件:
  - ぷよの落下: スムーズなイージングアニメーション
  - ぷよの消滅: パーティクル付きポップ/バーストエフェクト
  - 連鎖反応: 遅延を伴うカスケード視覚効果
  - スコアポップアップ: フローティングテキストアニメーション
  - ゲーム状態間のトランジションエフェクト

  オーディオ/ビジュアルフィードバック:
  - 有効な操作の視覚インジケーター
  - 大連鎖時の画面シェイク (オプション)
  - マッチングぷよのグローエフェクト
  - ハイコンボ時の紙吹雪/セレブレーションエフェクト

  技術要件

  パフォーマンス:
  - 60 FPSのゲームプレイ
  - レスポンシブな入力処理 (<16ms遅延)
  - スムーズなアニメーションのための最適化されたレンダリング
  - 再レンダリングを防ぐ効率的な状態管理

  ブラウザサポート:
  - モダンブラウザ (Chrome、Firefox、Safari、Edge)
  - タブレット向けタッチ入力サポート
  - キーボード操作を主要入力として

  コード品質:
  - TypeScript strict mode準拠
  - コンポーネントの再利用性
  - ゲームロジックとプレゼンテーションの明確な分離
  - コアゲームロジックのユニットテスト
  - ESLint準拠

  非機能要件

  アクセシビリティ:
  - キーボードナビゲーションサポート
  - スクリーンリーダー対応のスコアアナウンス
  - ハイコントラストモードオプション
  - 設定可能なカラースキーム

  パフォーマンス指標:
  - 初回ロード時間: <2秒
  - インタラクティブまでの時間: <3秒
  - バンドルサイズ: コード分割で最適化

  データ永続化:
  - localStorageにハイスコアを保存
  - ゲーム設定/プリファレンスの永続化
  - オプション: 再開用のゲーム状態保存

  ゲーム開発ガイドライン

  ぷよぷよゲームを構築する際は:

  1. コンポーネント構造: ゲームコンポーネントは app/components/ に配置
    - GameBoard/: ボードレンダリングとゲーム状態
    - Puyo/: アニメーション付き個別ぷよコンポーネント
    - Controls/: 入力処理とコントロールパネル
    - UI/: スコア、NEXTぷよ、ゲームオーバー画面
    - hooks/: ゲームロジック用カスタムフック
  2. ゲーム状態管理: React hooksとカスタム状態管理を使用:
    - ボード状態 (2D配列表現)
    - アクティブな落下中のペア (位置、色、回転)
    - ゲームステータス (プレイ中、一時停止、ゲームオーバー)
    - スコア、連鎖数、コンボ数
    - 入力キューとタイミング
  3. アニメーション & 物理演算:
    - シンプルなトランジションにはTailwind経由のCSSアニメーション
    - 複雑なゲームアニメーションには framer-motion を検討
    - requestAnimationFrame でゲームループを実装
    - 物理演算とレンダリングを分離
  4. スタイリングアプローチ:
    - レイアウトとレスポンシブデザインにはTailwindユーティリティクラス
    - ぷよスタイリングにはCSSモジュールまたはTailwindクラス
    - ぷよエフェクトにはCSSキーフレームアニメーション
    - テーマ切り替え付きダーク/ライトモード
  5. ゲームループアーキテクチャ:
    - 物理演算用の固定タイムステップ (60 ticks/秒)
    - ブラウザ性能に基づく可変レンダリング
    - 入力の取りこぼしを防ぐ入力バッファリング
    - 一時停止/再開機能用の状態スナップショット

  既知の問題

  - 3件の高レベルnpm脆弱性が検出されています (npm audit fix で対処してください)   
  - 依存関係ツリーにいくつかの非推奨パッケージがあります (機能しますが、将来的に更新を検討)